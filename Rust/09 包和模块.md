[toc]

# 包和模块

## 包和Package

Rust提供的包管理工具

*   项目(Package):可以用来构建、测试和分享包。
*   工作空间(WorkSpace):对于大型项目，可以进一步将多个包联合在一起，组织成工作空间。
*   包(Create):一个由多个模块组成的树形结构，可以作为第三方库进行分发，也可以生成可执行文件进行运行。
*   模块(Module):可以一个文件多个模块，也可以一个文件一个模块，模块可以认为是真实项目中的代码组织单元。

### 包 Create

对于Rust而言，包是一个独立的可编译单元，它编译后会生成一个可执行文件或者一个库。

一个包会将相关联的功能打包在一起，使得该功能可以很方便的在多个项目中分享。例如标准库中没有提供但是在第三方库中提供的rand包，他提供了随机数生成的功能，只需要将该功能通过`use rand;`引入到当前的项目的作用域中，就可以在项目中使用rand的功能。

>   同一个包不能有同名的类型，但是在不同的包中可以。

### 项目 Package

可以理解为工程、软件包。

Package就是一个项目，它包含独立的Cargo.toml文件，以及因为功能性被组织在一起的一个或多个包。一个Package只能包含一个库(library)类型的包，但是可以包含多个二进制可执行类型的包。

## 模块 Module

使用模块可以将包中的代码按照功能性进行重组，最终实现更好的可读性和易用性。同时，还能非常灵活地取控制代码地可见性，进一步强化Rust地安全性。

### 创建嵌套模块

使用`cargo new --lib restaurant`创建一个库类型地Package

~~~ rust
mod front_of_house {
    mod hosting {
        fn add_to_waitlist() {}
        fn seat_at_stable() {}
    }
    mod serving {
        fn take_order() {}
        fn serve_order() {}
        fn take_playment() {}
    }
}
~~~

*   使用mod关键字来创建新模块，后面紧跟模块的名称
*   模块可以嵌套
*   模块中可以定义各种Rust类型，例如函数、结构体、枚举、特征等
*   所有模块均定义在同一个文件中

#### 用路径引用模块

*   绝对路径：从create root 开始，路径名以包名或者create作为开头
*   相对路径：从当前模块开始，以self，super或当前模块地标识符作为开头

~~~ rust
mod front_of_house {
    mod hosting {
        fn add_to_waitlist() {}
    }
}
pub fn eat_at_restaurant() {
    // 绝对路径
    create::front_of_house::hosting::and_to_waitlist();
    // 相对路径
    front_of_house::hosting::and_to_waitlist();
}
~~~

### 代码地可见性

出于安全考虑，默认情况下，所有类型都是私有化地。

夫模块完全访问子模块中地私有项，但是子模块可以访问父模块，父父模块..模块的私有项。

#### pub 关键字

~~~ rust
mod front_of_house {
    pub mod hosting {
        pub fn add_to_waitlist() {}
    }
}
~~~

### 使用super引用父模块

super代表的是父模块为开始的引用方式。

~~~ rust
fn serve_order() {}
mod back_of_house {
    fn fix_incorrect_order() {
        cook_order();
        super::serve_order();
    }
    fn cook_order() {}
}
~~~

### 使用self引用自身模块

~~~ rust
fn serve_order() {
    self::back_of_house::cook_order()
}
mod back_of_house {
    fn fix_incorrect_order() [
        cook_order();
        create::serve_order();
    ]
    pub fn cook_order() {}
}
~~~

### 结构体和枚举的可见性

*   将结构体设置为pub，但是它所有的字段依然是私有的
*   将枚举设置为pub，它的所有字段也将对外可见

因为枚举成员对外不可见，枚举将一点用也没有。

### 模块与文件分离

~~~ rust
// src/front_of_house.rs
pub mod hosting {
    pub fn add_to_waitlist() {}
}
// src/lib.rs
mod front_of_house;
pub use create::front_of_house::hosting;
pub fn eat_at_restaurant() {
    hosting::add_to_waitlist();
    hosting::and_to_waitlist();
}
~~~

*   mod front_of_house;告诉Rust从另一个和模块`front_of_house`同名的文件中加载该模块的内容
*   使用绝对路径的方式来引用hosting模块：create::front_of_house::hosting;

在这里，模块的声明和实现是分离的，实现在单独的front_of_house.rs文件中，然后通过mod front_of_house;这条语句从该文件中把模块内容加载进来。

使用use关键字来将外部模块中的项引入到当前作用域中来，这样就无需冗长的父模块前缀即可调用。

使用文件夹作为一个模块

~~~ rust
// src/front_of_house/hosting.rs
pub fn add_to_waitlist() {}
// src/front_of_house/front_or_house.rs   或者   src/front_of_house/mod.rs
pub mod hosting;
~~~

需要在目录里创建一个mod.rs文件或者与模块同名的rs文件来定义子模块。

