# 存储器系统

[toc]

* 存储器系统的概念
* 半导体存储器的分类及其特点
* 半导体存储芯片的外部特性及其系统的连接
* 存储器接口设计（存储器扩展技术）
* 高速缓存

存储器是计算机系统的记忆设备，用于存放计算机要执行的指令、处理的数据、运算的结果以及各种需要保存的信息。

存储系统是将两个或两个以上速度、容量和价格各不相同的存储器用硬件、软件或软硬结合的方法连接起来。

## 存储系统的分类

* Cache存储系统
  * 主存储器
  * 高速缓冲存储器
* 虚拟存储器
  * 主存储器
  * 磁盘存储器

Cache存储系统的管理全部由硬件实现，无需系统干预。

虚拟存储系统由主存储器与磁盘存储器构成。它将主存和外存看作一个整体，用软硬件结合的方法进行管理，使得程序员能够对主存，辅存统一编制，这样形成的一个很大的地址空间，称为虚拟地址空间。

## 主要性能指标

* 存储容量（S）  字节，千字节、兆字节
* 存取时间（T）   与系统的命中率有关
  * 命中率（H）
  * $$T=H*T1+(1-H)*T2$$
* 单位容量价格（C）
* 访问效率（e）

## 半导体存储器及其分类

内存储器：主要是由半导体材料制成，也称半导体存储器
外存储器：由磁性材料或复合材料制造，包括硬磁盘，软盘，可移动硬盘，磁带，CD-ROM等

### 特点

* 内存（主存）是计算机主机的组成部分之一，用来存储当前运行所需的程序和数据，CPU可以直接访问并与其信息交换;外存属于外部设备，CPU不能直接访问，必须通过专门的接口才能实现与CPU的信息交换。
* 内存的容量小，存取速度快，价格相对较高;外存储器的容量大，价格低，但速度慢。
* 内存是数据的“临时住所”，主要用于存放程序运行时所需的信息，当程序运行结束或关机后，除少量信息(如BIOS等)外，其他信息都会立即消失。而外存储器则用于大容量，永久性的数据的保存。

### 存储元

半导体存储器由一些能够表示i二进制“0”和“1”的状态的物理器件组成，这些器件本身具有记忆功能，如电容、双稳态电路等。将这些具有记忆功能的物理器件叫做存储单元（如一个电容就是一个存储单元）。每个存储元可以保存一位h二进制信息。若干个存储元就构成了一个存储单元。在微机系统中，一个存储单元通常存放8位二进制编码（1B），即一个存储单元由8个存储元构成，许多存储单元组织在一起构成了存储器。

> 存储单元的总数称为i存储器的存储容量。

### 半导体存储器的分类

半导体存储器按照工作方式不同分为：

* 随机存取存储器RAM
* 只读ui存储器ROM

#### 随机存取存储器RAM

RAM的主要特点是可以随机进行读写操作，但掉电后信息消失，是目前微机中主内存的主要构成部件。

##### 双极型半导体RAM

存取时间短，集成度低，功耗大，价格高，主要用于要求存取时间非常短的特殊应用场合（如高速缓冲存储器Cache）。

##### 金属氧化物半导体RAM（MOS）

用MOS器件构成的RAM又分为静态读写存储器（SRAM）和动态读写存储器（DRAM）。

SRAM的存储元由双稳态触发器构成
DRAM的存储元用电容来存储信息

> 现在微型计算机中的内存主要由MOS型DRAM组成。

#### 只读存储器ROM

只读存储器包括掩模存储器ROM，PROM,EPROM,EEPROM等几种类型。

ROM的主要特点是掉电后不会丢失所存储的内容，可随机进行读操作，但不能写入或只有条件编程写入，常用于存放相对不变的数据（如BIOS等）。

1. 掩模式只读存储器ROM：对芯片图形（掩模）进行二次光刻
2. 可编程ROM（PROM）：允许用户进行一次编程，写入数据或程序。一旦编程后，信息永久保存下来
3. 可读写ROM：允许用户通过一定的方式多次写入数据或程序，也可以修改和擦除其中的内容。不会因为掉电而丢失
   1. 通过紫外线（约20分钟）进行擦除旁：EPROM
   2. 通过电信号（通常是加电压）进行擦除：EEPROM

## 半导体存储器的主要技术指标

### 存储容量

$$存储器的存储容量=存储单元的个数 X 每个存储单元的位数$$

> 例如：
> SRAM芯片6264的容量为 8K x 8b，即它有8K各单元(1K=1024)，每个单元存储8位个二进制数据

### 存取时间和存取周期

存取时间又称为存储器访问时间，即启动一次存储器操作（读或写）到完成该操作所需的时间。

存取周期是连续启动两次独立的存储器操作所需间隔的最小时间。

> 若令存取时间为t<sub>A</sub>，存取周期为T<sub>C</sub>，则二者的关系为 T<sub>C</sub> >= t<sub>A</sub>

### 可靠性

> 目前所用的半导体存储器芯片的平均故障间隔时间为 5\*10<sup>6</sup> ~ 1\*10<sup>8</sup>小时

### 功耗

功耗低的存储器可以减少电源容量的要求，还可以提高存储系统的可靠性。

## 随机存取存储器

随机存取存储器RAM主要用来存放当前运行的程序、各种输入输出数据、中间运算结果及堆栈等，其存储的内容可以随时读出，也可以随时写入和修改，掉电后内容会全部丢失。

### SRAM芯片的应用

#### 地址译码

将一组输入信号转换为一个确定的输出。在存储器系统中，译码就是将高位地址信号通过一组电路（译码器）转换为一个确定的输出信号，并将其连接到存储器芯片的片选端，使该芯片被选中，从而使系统可以对该芯片上的单元进行读写操作。

8088/8086CPU能够寻址的内存空间为1MB,共有20根地址信号线。

> 地址译码的方式多种多样，综合起来主要分为两种：用基本逻辑门电路构成译码器或用专门译码器进行编译。

#### 地址译码方式

地址译码方式可以分为两种：全地址译码和部分地址译码

##### 全地址译码方式

构成存储器时用全部20位地址总线信号，即所有的高位地址信号都用来作为译码器输入，低位地址信号接存储芯片的地址输入线，从而使得存储芯片上的每一个单元在整个内存空间中具有唯一的地址。

#### 部分地址译码方式

仅把地址总线的一部分地址信号线与存储器连接，通常是用高位地址信号的一部分作为片选译码信号。

## 动态随机存取存储器

动态随机存取存储器(DRAM)的存储元有两种结构：四管存储元和单管存储元。

四管存储元的缺点是元件多、占用芯片面积大，故集成度较低，但外围电路较简单。
单管存储元的元件数量少、集成度高，但外围电路比较复杂。

> DRAM集成度高、价格低，在微型计算机中有着及其广泛的使用。构成微机内存的内存条几乎毫无例外都是由DRAM组成。

## 存储器扩展技术

任何存储芯片的存储容量都是有限的。要构成一定容量的内存，往往单个芯片不能满足字长或存储单元个数的要求，甚至字长、存储单元数都不能满足要求。

这时就需要用多个存储芯片进行组合，以满足对存储容量的需求。这种组合就称为存储器的扩展，扩展时要解决的问题包括位扩展，字扩展和字位扩展。

### 位扩展

一块实际的存储芯片，其每个单元的位数（即字长）往往与实际内存单元字长并不相等。

位扩展构成的存储器系统的每个单元中的内容

位扩展保持总的地址单元数（存储单元个数）不变，但每个单元中的位数增加。

> 位扩展的电路连接方法是：将每个存储芯片的地址线和控制线（包括片选信号线、读写信号线等）全部并联在一起，而他们的数据总线的不同位上。

### 字扩展

字扩展是对存储器容量的扩展（或存储空间的扩展）。此时存储芯片上每个存储单元的字长已满足要求（如字长已为8位），只是存储单元的个数不够，需要增加的是存储单元的数量。

> 多片字长为8位的存储芯片构成所需要的存储空间。

字扩展的电路连接方法是：将每个芯片的地址信号、数据信号和读写信号等控制信号按信号名称全部并联在一起，只将片选端分别引出到地址译码器的不同输出端，即用片选信号来区别各个芯片的地址。

## 高速缓冲存储器

一个微机系统整体性能的高低与许多因素有关，如CPU主频的高低、存储器的存取速度、系统架构、指令结构、信息在各部件之间的传送速度等，而CPU与内存之间的存取速度则是一个很重要的因素。

减少CPU与内存之间速度差异的办法主要有3种：

1. 在基本总线周期中插入若干等待周期让CPU等待内存的数据，这样做虽然方法简单，但显然会浪费CPU的能力;
2. 采用存取速度较快的SRAM作存储器，这样虽可基本解决CPU与存储器之间速度不匹配的问题，但成本很高，而且SRAM的速度始终不能赶上CPU速度的发展;
3. 在慢速的DRAM和快速的CPU之间插入一个速度较快、容量较小的SRAM,起到缓冲作用，使CPU既可以以较快速度存取SRAM中的数据，又不使系统成本上升过高（Cache）。

### Cache的工作原理

Cache的工作原理是基于程序和数据访问的局部性。

任何程序或数据要为CPU所使用，必须先放到主存储器，即内存中。jCPU只与主存交换数据，所以主存的速度很大程度上决定了系统的运行速度。

> Cache 的命中率与Cache的大小、替换算法、程序特性等因素有关。

### Cache的读写操作

* 贯穿读出法
* 旁路由读出法
* 写直达法
* 回写法

### Cache与主存的存取一致性

对Cache的管理全部是由硬件实现的，不论是应用程序员还是系统程序员，都看不到系统中有Cache存在。
在Cache存储器系统中，存储器的编址方式与主存储器是完全一致的。

由于以下两个原因，在一段时间内，主存某单元的内容和Cache对应的单元中的内容可能会不相同。

1. 当CPU向Cache中写入一个数据时，Cache某单元中的数据就从X被修改为X’，而主存对应单元中的内容则没有改，还是X.
2. 在输入输出操作中，I/O设备的数据会写入到主存，修改了主存中的内容，将X变成了X’，但Cache对应单元中的内容此时还是X.

为了解决这个问题，可以采用以上讲到的写直达法或回写法。

---

### SRAM-6264

![6264](https://bkimg.cdn.bcebos.com/pic/023b5bb5c9ea15ce1fcdf183bd003af33a87b21c?x-bce-process=image/format,f_auto/resize,m_lfit,limit_1,h_480)

1.   芯片的地址译码是A0-A12共13位地址译码电路。
2.   芯片有I/O0-I/O7共八位数据传送线。
3.   所以该芯片是8K*8位的

### DRAM-2164

![2164](https://img-blog.csdnimg.cn/20190908201059462.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly94aW9uZzUzNS5ibG9nLmNzZG4ubmV0,size_16,color_FFFFFF,t_70)

2164容量为64k*1bit，内部有65536个动态存储单元。整个芯片每2ms刷新一遍，若每次刷新512个存储单元，64k个存储单元需要128个刷新周期。封装时仅将8条地址线引出到芯片外部。

*   A0\~A7：地址线
*   WE：读写控制线，WE=1读，WE=0写
*   RAS：行选通信号
*   CAS：列选通信号
*   D~in~：数据输入
*   D~out~：数据输出
*   V~cc~：+5V
*   GND：地

## 存储器与CPU的连接

CPU发出的地址信号必须实现两种选择

1.   片选(片外寻址): 对存储器芯片的选择，使相关芯片的片选端CS为有效。
2.   字选(片内寻址): 在选中的芯片内部再选择某一存储单元。

片选信号和字选信号均由CPU发出的地址信号经译码电路产生

*   片选信号：由存储器芯片的外部译码电路产生，需自行设计
*   字选信号：由存储器芯片内部译码电路产生，不需要自行设计

### 两种译码方法

#### 线性选择法

直接用CPU地址总线某一位高位线作为存储器芯片的片选信号

优点：连接简单，片选信号的产生不需要复杂的逻辑电路

缺点：

1.   当采用线选时，高位地址位全部用完，而又没有对其实施控制时，会出现地址的不连续性和多义性
2.   即使所有的高位地址线都用作线选，其能寻址的存储空间也十分有限

#### 全译码法

将高位地址全部作为译码器的输入，用译码器的输出作为片选信号。

低位地址线用作字选，与芯片的地址输入端直接相连；高位地址线全部作为连接进译码电路，用来生成片选信号。这样，所有的地址线均参与片内或片外的地址译码，不会产生地址的多义性和不连续性。再全译码方式中，译码电路的核心常用一块译码器充当，例如**74LS138**等。

### 74LS138译码器

![74LS138](https://bkimg.cdn.bcebos.com/pic/79f0f736afc37931d27fab6ce2c4b74543a9115b?x-bce-process=image/resize,m_lfit,w_536,limit_1/quality,Q_70)

![74LS138](https://th.bing.com/th/id/OIP.nzE89PLqpS_z65Ez33PvtgAAAA?rs=1&pid=ImgDetMain)

3个输入端：A、B、C，C是最高位

3个使能端：G1、G~2A~\\、G~2B~\\，只有他们都满足的时候工作

8个输出端：Y0\\——Y7\\

#### 真值表

![74LS138真值表](https://th.bing.com/th/id/R.35ae07684319b9f9242c14f17c0f8f6e?rik=e%2fMFF9Ev5VOU4w&riu=http%3a%2f%2fimg.jdzj.com%2fjishu%2f636531673551250000.jpg&ehk=bvl9W3dAQUqRlKNzn8aAs2w8qrhTQZ6KFMZj7TDQTjA%3d&risl=&pid=ImgRaw&r=0)

#### 电路连接

![eg](https://odmg.pages.dev/file/d4f0f12fcbdcd1d861bdb.png)

内存扩展步骤：

1.   在给定的各芯片中选用片内寻址(片内译码)线较多的为基准，提前将这些片内译码线预留出来，直接接入芯片即可。若出现未对齐的问题（如一个为1K一个为2K），则将差出的地址线参与容量较小的芯片的选择译码；
2.   除片内译码线外，将剩余的地址线最低三位接入38译码器的输入端(A,B,C),需要注意的是A为最低为，C为最高位。
3.   将剩余的地址线进行38译码器的选通，为0的地址线过或门接入G2A\\,G2B\\,引脚，为1的地址线过与门接入G1引脚。若地址线不够用，则使G2A\\，G2B\\接地，G1接+5V即可。
4.   若出现1所说的芯片对其问题，在需考虑将未参与译码的地址线参与片选。

